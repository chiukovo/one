<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KUJI X IMPACT - Ë∂ÖÊ¨°ÂÖÉ‰∏ÄÁï™Ë≥û</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&family=Bebas+Neue&display=swap" rel="stylesheet">
    <style>
        :root {
            --anime-yellow: #facc15;
            --anime-red: #ef4444;
            --anime-cyan: #22d3ee;
            --anime-dark: #0f172a;
        }        * {
            box-sizing: border-box;
        }

        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            overflow-x: hidden;
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: var(--anime-dark);
            color: white;
            -webkit-tap-highlight-color: transparent;
            background-image: radial-gradient(rgba(255, 255, 255, 0.05) 1px, transparent 0);
            background-size: 20px 20px;
            user-select: none;
            position: relative;
        }

        .font-bebas { font-family: 'Bebas Neue', cursive; }

        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }

        /* ÊñúÂàáË®≠Ë®à */
        .skew-box { transform: skewX(-10deg); }
        .unskew { transform: skewX(10deg); }

        /* ÂãïÊº´È¢®ÊåâÈàï */
        .btn-anime {
            position: relative;
            background: var(--anime-yellow);
            color: black;
            font-weight: 900;
            border: 3px solid black;
            box-shadow: 4px 4px 0px black;
            transition: all 0.1s;
        }
        .btn-anime:active {
            transform: translate(2px, 2px);
            box-shadow: 1px 1px 0px black;
        }        /* Á±§Á¥ôÂç°Áâá - ‰∏ÄÁï™Ë≥ûÁ±§Á¥ôÈ¢®Ê†º */
        .ticket-card {
            position: relative;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            filter: grayscale(0.8) brightness(0.4);
            transform: scale(0.85);
            background: linear-gradient(135deg, #ff5722 0%, #ff7043 50%, #ff8a65 100%);
            border: 3px solid white;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.2), 0 4px 8px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .ticket-card::before {
            content: '';
            position: absolute;
            top: 8px;
            left: 8px;
            right: 8px;
            bottom: 8px;
            border: 2px solid rgba(255,255,255,0.6);
            pointer-events: none;
        }
        
        .ticket-card::after {
            content: '';
            position: absolute;
            inset: 0;
            background: repeating-linear-gradient(
                90deg,
                transparent,
                transparent 2px,
                rgba(255,255,255,0.03) 2px,
                rgba(255,255,255,0.03) 4px
            );
            pointer-events: none;
        }
        
        .ticket-card.active {
            filter: grayscale(0) brightness(1.1);
            transform: scale(1.05) rotate(-2deg);
            border-color: white;
            box-shadow: inset 0 0 30px rgba(255,255,255,0.3), 
                        0 0 40px rgba(255, 87, 34, 0.8),
                        0 8px 16px rgba(0,0,0,0.4);
            z-index: 10;
        }        /* Âí™ÁâåÂ∞ÅÈù¢ÈÅÆÁΩ© - ÁßªÈô§ pointer-events */
        #ticket-cover {
            clip-path: polygon(0% 0%, 100% 0%, 100% 100%, 0% 100%);
            will-change: clip-path;
            cursor: move;
            cursor: grab;
        }
        
        #ticket-cover:active {
            cursor: grabbing;
        }

        /* Èò≤Ê≠¢ÊâÄÊúâË¶ÜËìãÂ±§ÈÄ†ÊàêÊ©´ÂêëÊªæÂãï */
        .fixed {
            max-width: 100vw;
            overflow-x: hidden;
        }/* ÁßªÈô§ÊäñÂãïÊïàÊûú */        /* ÊíïË£ÇÁóïË∑°ÊïàÊûú */
        .tear-effect {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            background: linear-gradient(135deg, 
                transparent 0%, 
                rgba(255,255,255,0.15) 48%, 
                rgba(255,255,255,0.3) 50%, 
                rgba(255,255,255,0.15) 52%, 
                transparent 100%);
            opacity: 0;
            transform: translateX(-100%);
            transition: transform 0.3s linear, opacity 0.2s;
        }

        #ticket-cover.tearing .tear-effect {
            opacity: 1;
            transform: translateX(100%);
        }

        /* ÁçéÂìÅÂÖßÂÆπÊ∑°ÂÖ• */
        #prize-content {
            opacity: 0;
            transform: scale(0.9) rotate(-2deg);
            transition: opacity 0.8s ease-out, transform 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        
        #prize-content.revealed {
            opacity: 1;
            transform: scale(1) rotate(0deg);
        }        /* ÂÆπÂô®ÂãïÁï´ */
        @keyframes ticket-enter {
            from {
                opacity: 0;
                transform: scale(0.85) translateY(40px) rotate(-5deg);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0) rotate(0deg);
            }
        }

        .ticket-enter {
            animation: ticket-enter 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        /* Èò≤Ê≠¢Èô∞ÂΩ±ÈÄ†ÊàêÊ©´ÂêëÊªæÂãï */
        .shadow-large {
            box-shadow: 6px 6px 0px rgba(0,0,0,1);
        }

        @media (min-width: 768px) {
            .shadow-large {
                box-shadow: 10px 10px 0px rgba(0,0,0,1);
            }
        }

        /* Á¢∫‰øùÂÆπÂô®‰∏çÊúÉÂõ†ÁÇ∫Èô∞ÂΩ±Ê∫¢Âá∫ */
        .container-safe {
            margin-right: 12px;
        }

        @media (min-width: 768px) {
            .container-safe {
                margin-right: 16px;
            }
        }

        /* Èò≤Ê≠¢ÊâÄÊúâÂ∏∂Èô∞ÂΩ±ÁöÑÂÖÉÁ¥†ÈÄ†ÊàêÊ∫¢Âá∫ */
        section, .grid > div {
            position: relative;
        }

        /* ÊâãÊ©üÁâàÈ°çÂ§ñ‰øùË≠∑ */
        @media (max-width: 767px) {
            section {
                margin-right: 6px !important;
            }
            
            .shadow-\[8px_8px_0px_rgba\(0\,0\,0\,1\)\] {
                box-shadow: 4px 4px 0px rgba(0,0,0,1) !important;
            }
        }

        /* ÁßªÈô§ÂÖ®ÊôØÈÅÆÁΩ©ÂãïÁï´ */

        /* Ë∑ëÈ¶¨Ááà */
        .marquee-container { overflow: hidden; white-space: nowrap; }
        .marquee-content { display: inline-block; animation: marquee 25s linear infinite; }
        @keyframes marquee {
            0% { transform: translateX(100vw); }
            100% { transform: translateX(-100%); }
        }

        /* ÈÄüÂ∫¶Á∑öËÉåÊôØ */
        .speed-lines {
            background: repeating-conic-gradient(from 0deg, transparent 0deg 1.5deg, rgba(255,255,255,0.03) 1.5deg 3deg);
            animation: rotate-lines 15s linear infinite;
        }
        @keyframes rotate-lines {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }        @keyframes shake {
            0%, 100% { transform: translate(0, 0); }
            20% { transform: translate(-2px, 1px); }
            40% { transform: translate(2px, -1px); }
        }
        .animate-shake { animation: shake 0.3s infinite; }

        .no-scroll { overflow: hidden; height: 100vh; }

        /* ============ Â§ßÁçéÁâπÊïàÂãïÁï´ ============ */
        
        /* AË≥ûÔºöÈáëËâ≤Á≤íÂ≠êÁàÜÁÇ∏ */
        @keyframes goldExplosion {
            0% { 
                transform: scale(0.5) rotate(0deg);
                opacity: 0;
            }
            50% { 
                transform: scale(1.2) rotate(180deg);
                opacity: 1;
            }
            100% { 
                transform: scale(1) rotate(360deg);
                opacity: 1;
            }
        }
        
        @keyframes goldPulse {
            0%, 100% { 
                box-shadow: 0 0 20px rgba(255, 215, 0, 0.8), 
                            0 0 40px rgba(255, 215, 0, 0.6),
                            0 0 60px rgba(255, 215, 0, 0.4);
            }
            50% { 
                box-shadow: 0 0 40px rgba(255, 215, 0, 1), 
                            0 0 80px rgba(255, 215, 0, 0.8),
                            0 0 120px rgba(255, 215, 0, 0.6);
            }
        }
        
        @keyframes goldParticle {
            0% { 
                transform: translate(0, 0) scale(1);
                opacity: 1;
            }
            100% { 
                transform: translate(var(--tx), var(--ty)) scale(0);
                opacity: 0;
            }
        }
        
        .prize-a-effect {
            animation: goldExplosion 1s cubic-bezier(0.34, 1.56, 0.64, 1), 
                       goldPulse 2s ease-in-out infinite 1s;
        }
        
        /* BË≥ûÔºöÈäÄËâ≤ÂÖâËäí */
        @keyframes silverShine {
            0% { 
                transform: scale(0.8) rotate(-10deg);
                opacity: 0;
                filter: brightness(1);
            }
            50% { 
                transform: scale(1.1) rotate(5deg);
                opacity: 1;
                filter: brightness(1.5);
            }
            100% { 
                transform: scale(1) rotate(0deg);
                opacity: 1;
                filter: brightness(1);
            }
        }
        
        @keyframes silverGlow {
            0%, 100% { 
                box-shadow: 0 0 15px rgba(192, 192, 192, 0.6),
                            0 0 30px rgba(192, 192, 192, 0.4);
            }
            50% { 
                box-shadow: 0 0 30px rgba(192, 192, 192, 0.9),
                            0 0 60px rgba(192, 192, 192, 0.6);
            }
        }
        
        @keyframes starFall {
            0% { 
                transform: translateY(-100%) rotate(0deg);
                opacity: 1;
            }
            100% { 
                transform: translateY(200%) rotate(360deg);
                opacity: 0;
            }
        }
        
        .prize-b-effect {
            animation: silverShine 0.8s cubic-bezier(0.34, 1.56, 0.64, 1),
                       silverGlow 2s ease-in-out infinite 0.8s;
        }
          /* CË≥ûÔºöÂΩ©ËôπÊº∏ËÆäÔºàÁßªÈô§ÊóãËΩâÂãïÁï´Ôºâ */
        @keyframes rainbowGlow {
            0% { 
                box-shadow: 0 0 20px rgba(255, 0, 0, 0.5);
            }
            25% { 
                box-shadow: 0 0 20px rgba(255, 255, 0, 0.5);
            }
            50% { 
                box-shadow: 0 0 20px rgba(0, 255, 0, 0.5);
            }
            75% { 
                box-shadow: 0 0 20px rgba(0, 0, 255, 0.5);
            }
            100% { 
                box-shadow: 0 0 20px rgba(255, 0, 255, 0.5);
            }
        }
        
        .prize-c-effect {
            animation: rainbowGlow 3s linear infinite;
        }
        
        /* Á≤íÂ≠êÂÆπÂô® */
        .particles-container {
            position: absolute;
            inset: 0;
            pointer-events: none;
            overflow: hidden;
        }
        
        .particle {
            position: absolute;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            animation: goldParticle 1.5s ease-out forwards;
        }
        
        .star {
            position: absolute;
            font-size: 24px;
            animation: starFall 2s linear forwards;
        }
        @media (min-width: 768px) {
            .container-safe {
                margin-right: 16px;
            }
        }

        /* ÁÇ∫ÊâÄÊúâ‰∏ªË¶ÅÂÆπÂô®Ê∑ªÂä†ÂÆâÂÖ®ÈÇäË∑ùÔºåÈò≤Ê≠¢Èô∞ÂΩ±ÈÄ†ÊàêÊ©´ÂêëÊ∫¢Âá∫ */
        .space-y-10 > section,
        .space-y-6 > section,
        .grid > div {
            max-width: 100%;
        }

        /* ‰øÆÂæ©ÁµïÂ∞çÂÆö‰ΩçÂÖÉÁ¥†ÂèØËÉΩÈÄ†ÊàêÁöÑÊ∫¢Âá∫ */
        .absolute.-right-4 {
            right: -12px;
        }

        @media (max-width: 767px) {
            .absolute.-right-4 {
                right: -8px;
            }
        }
    </style>
</head>
<body class="pb-20 md:pb-0">    <!-- È†ÇÈÉ®Â∞éË¶Ω -->
    <header class="sticky top-0 z-40 bg-black/95 backdrop-blur-md border-b-2 border-yellow-400">
        <div class="max-w-6xl mx-auto px-4 h-16 md:h-20 flex items-center justify-between">
            <div class="flex items-center gap-3 cursor-pointer group" onclick="showView('list')">
                <div class="bg-yellow-400 p-1.5 md:p-2 border-2 border-black -rotate-6">
                    <i data-lucide="zap" class="text-black w-5 h-5 md:w-6 md:h-6 fill-current"></i>
                </div>
                <h1 class="font-black text-xl md:text-2xl italic uppercase tracking-tighter">
                    Kuji<span class="text-yellow-400">X</span>Impact
                </h1>
            </div>
            <div class="flex items-center gap-3">
                <div class="flex items-center gap-2 bg-slate-800 px-4 py-2 rounded-full border border-white/10">
                    <i data-lucide="coins" class="w-4 h-4 md:w-5 md:h-5 text-yellow-400"></i>
                    <span class="font-black font-bebas text-base md:text-lg">9,999</span>
                </div>
                <div class="w-9 h-9 md:w-10 md:h-10 rounded-full bg-blue-600 border-2 border-white flex items-center justify-center shadow-lg">
                    <i data-lucide="user" class="w-5 h-5 md:w-6 md:h-6 text-white"></i>
                </div>
            </div>
        </div>
        <!-- Âø´Ë®äË∑ëÈ¶¨Ááà -->
        <div class="bg-red-600 text-xs md:text-sm font-black italic tracking-wider py-1 border-b border-black marquee-container">
            <div class="marquee-content">
                <span class="mx-6 text-white uppercase"><span class="text-yellow-300">JACKPOT:</span> Áé©ÂÆ∂ [GOD_HAND] ÊäΩÂæó A Ë≥ûÔºÅ</span>
                <span class="mx-6 text-white uppercase"><span class="text-yellow-300">NEWS:</span> ÂÖ®ÁúãÊùøÊ©üÁéá UP ‰∏≠ÔºÅ</span>
                <span class="mx-6 text-white uppercase"><span class="text-yellow-300">ALERT:</span> Ê∂âË∞∑‰∫ãËÆäÁúãÊùøÂç≥Â∞áÂÆåÂîÆÔºÅ</span>
            </div>
        </div>
    </header>

    <main id="app-content" class="max-w-6xl mx-auto p-4 md:p-6 w-full"></main>    <!-- 1. ÈÅ∏Á±§Êùø (Ê°åÊ©üÊîØÊè¥ÊåâÈàïËàáÊãñÊãΩ) - Ê∑ªÂä†ÂÖ®ÊôØÈÅÆÁΩ© -->
    <div id="selection-overlay" class="fixed inset-0 z-50 hidden flex flex-col items-center justify-center bg-black/98 overflow-hidden">
        <!-- ÂÖ®ÊôØÈÅÆÁΩ©ËÉåÊôØ -->
        <div class="speed-lines absolute inset-0 opacity-10 pointer-events-none"></div>
        <div class="absolute inset-0 bg-gradient-to-b from-slate-900 via-slate-800 to-black pointer-events-none"></div>
          <div class="text-center mb-6 md:mb-8 relative z-10 px-4">
            <h2 class="text-3xl md:text-5xl font-black italic text-yellow-400 mb-2 drop-shadow-md">ÂëΩÈÅã„ÅÆÊåëÈÅ∏</h2>
            <p class="text-cyan-400 font-bold tracking-widest text-sm md:text-base uppercase opacity-70" id="draw-type-label">ÈÅ∏Êìá‰Ω†ÁöÑÂπ∏ÈÅãÁ±§</p>
        </div>

        <div class="relative w-full z-10 flex items-center justify-center px-4">
            <button onclick="moveCarousel(-1)" class="absolute left-4 md:left-16 z-30 bg-white/5 hover:bg-yellow-400 hover:text-black p-4 md:p-5 rounded-full border border-white/10 transition-all hidden md:block">
                <i data-lucide="chevron-left" class="w-10 h-10 md:w-12 md:h-12"></i>
            </button>

            <div id="ticket-carousel" class="w-full max-w-6xl overflow-x-auto flex items-center gap-4 px-[35vw] py-10 scrollbar-hide snap-x snap-mandatory cursor-grab active:cursor-grabbing"></div>

            <button onclick="moveCarousel(1)" class="absolute right-4 md:right-16 z-30 bg-white/5 hover:bg-yellow-400 hover:text-black p-4 md:p-5 rounded-full border border-white/10 transition-all hidden md:block">
                <i data-lucide="chevron-right" class="w-10 h-10 md:w-12 md:h-12"></i>
            </button>
        </div>        <div class="mt-8 relative z-10 flex flex-col items-center gap-4">
            <button onclick="confirmSelection()" id="confirm-btn" class="btn-anime px-16 md:px-20 py-4 md:py-5 text-2xl md:text-3xl italic tracking-tighter hover:scale-105">Â∞±Ê±∫ÂÆöÊòØ‰Ω†‰∫ÜÔºÅ</button>
            <div id="draw-count-info" class="text-white/60 text-sm md:text-base font-bold"></div>
        </div>
        <button onclick="closeSelection()" class="absolute top-4 right-4 text-white/30 hover:text-white"><i data-lucide="x" class="w-7 h-7 md:w-8 md:h-8"></i></button>
    </div>    <!-- 2. Âí™Áâå - ÂÖ®ÊôØÈÅÆÁΩ© -->
    <div id="peel-overlay" class="fixed inset-0 z-[60] hidden flex items-center justify-center p-4 select-none">
        <!-- ÂÖ®ÊôØÈÅÆÁΩ©ËÉåÊôØ -->
        <div class="absolute inset-0 bg-gradient-to-b from-slate-900 via-slate-800 toÈªëËâ≤"></div>
        <div class="speed-lines absolute inset-0 opacity-10 pointer-events-none"></div>
          <div class="relative z-10 w-full max-w-[300px] md:max-w-sm flex flex-col items-center">
            <div id="peel-hint" class="text-white text-base md:text-xl font-black mb-6 text-center animate-shake">
                <span class="bg-red-600 px-4 py-2 md:px-7 md:py-2.5 italic shadow-lg uppercase block">
                    <span class="text-sm md:text-base">‚ÜïÔ∏è ‰ªªÊÑèÊªëÂãïÊíïÈñã ‚ÜîÔ∏è</span>
                    <span class="block text-xs md:text-sm mt-1 opacity-90">Swipe to Peel!</span>
                </span>
            </div>

            <div id="kuji-ticket-container" class="relative w-full aspect-[2/3] bg-gray-900 rounded-xl shadow-2xl overflow-hidden border-2 border-white/10 ticket-enter">
                <!-- Â∫ïÂ±§ÁçéÂìÅ -->
                <div id="prize-content" class="absolute inset-0 bg-gradient-to-br from-white to-gray-50 flex flex-col items-center justify-center p-6 border-[10px] border-yellow-400 shadow-inner">
                    <div id="prize-icon" class="text-8xl md:text-9xl mb-4 drop-shadow-lg">üèÜ</div>
                    <div id="prize-rank" class="text-9xl md:text-[10rem] font-black italic text-black leading-none font-bebas drop-shadow-md">A</div>
                    <div id="prize-name" class="text-lg md:text-xl font-black text-center text-white bg-black px-5 py-2 md:px-6 md:py-2.5 mt-4 border-2 border-yellow-400 uppercase shadow-lg">Item Win!</div>
                </div>
                <!-- ÈÅÆÁΩ©Â∞ÅÈù¢ - ÂèØ‰∫íÂãïÔºå‰øÆÂæ©Ê∂àÂ§±ÂïèÈ°å -->
                <div id="ticket-cover" class="absolute inset-0 w-full h-full bg-slate-900 flex flex-col items-center justify-center z-10">
                    <!-- ÊíïË£ÇÂÖâÊïà -->
                    <div class="tear-effect"></div>
                    <!-- Â∞ÅÈù¢ÂÖßÂÆπ -->
                    <div class="absolute inset-0 opacity-20 bg-[radial-gradient(var(--anime-cyan)_1px,transparent_0)] bg-[size:10px_10px] pointer-events-none"></div>
                    <div class="border-4 border-yellow-400/40 p-6 w-[85%] h-[90%] flex flex-col items-center justify-center relative bg-black/50 backdrop-blur-sm pointer-events-none">
                        <div class="text-4xl md:text-5xl font-black text-white italic mb-2 drop-shadow-lg">‰∏ÄÊäΩÂÖ•È≠Ç</div>
                        <div class="text-cyan-400 font-bold text-sm md:text-base tracking-[0.2em] uppercase mb-10">LUCKY DRAW</div>
                        <i data-lucide="sparkles" class="w-12 h-12 md:w-14 md:h-14 text-yellow-400 opacity-40"></i>
                    </div>
                </div>
            </div>
            <button onclick="finishPeel()" class="mt-6 text-white/20 hover:text-white/60 font-bold text-xs md:text-sm border-b border-white/10 uppercase transition-colors">Skip Animation</button>
        </div>
    </div><!-- ÁßªÈô§ÈÅéÊ∏°ÈÅÆÁΩ© -->    <!-- 3. ÁµêÊûúÁàÜË£Ç -->
    <div id="result-overlay" class="fixed inset-0 z-[70] hidden flex items-center justify-center p-4 bg-black/95">
        <div class="speed-lines absolute inset-0 opacity-20"></div>
        
        <!-- Á≤íÂ≠êÁâπÊïàÂÆπÂô® -->
        <div id="particles-container" class="particles-container"></div>
        
        <!-- ÈóúÈñâÊåâÈàï -->
        <button onclick="document.getElementById('result-overlay').classList.add('hidden'); showView('detail');" class="absolute top-4 right-4 z-50 bg-white/10 hover:bg-white/20 text-white p-3 rounded-full border border-white/20 transition-all">
            <i data-lucide="x" class="w-6 h-6 md:w-7 md:h-7"></i>
        </button>
          <div id="result-card" class="bg-yellow-400 w-full max-w-sm p-1 border-4 border-black shadow-large animate-scale-in relative mx-auto">
            <div class="bg-white p-6 md:p-8 border-2 border-black relative text-center">
                <div id="res-icon" class="w-28 h-28 md:w-32 md:h-32 mx-auto bg-black flex items-center justify-center text-6xl md:text-7xl mb-4 border-4 border-yellow-400 shadow-lg rotate-3">üèÜ</div>
                <h2 id="res-rank" class="text-8xl md:text-9xl font-black text-black italic leading-none font-bebas">A</h2>
                <h3 id="res-name" class="text-xl md:text-2xl font-black text-black mt-3 mb-8 border-b-2 border-black pb-3">ÁçéÂìÅÂêçÁ®±</h3>                <div class="flex flex-col gap-3">
                    <button onclick="startDraw(1)" class="btn-anime py-4 md:py-5 text-xl md:text-2xl flex items-center justify-center gap-2">
                        <i data-lucide="rotate-cw" class="w-6 h-6 md:w-7 md:h-7"></i> ÂÜçÊäΩ‰∏ÄÊ¨°
                    </button>
                    <button onclick="showView('list')" class="bg-black text-white font-black py-3 text-sm md:text-base uppercase">ËøîÂõûÂ§ßÂª≥</button>
                </div>
            </div>
        </div>
    </div>    <!-- 4. 10ÈÄ£ÊäΩÁµêÊûú -->    <div id="draw10-overlay" class="fixed inset-0 z-[70] hidden bg-black/95 overflow-y-auto">
        <div class="speed-lines absolute inset-0 opacity-20"></div>
        
        <!-- ÈóúÈñâÊåâÈàï -->
        <button onclick="document.getElementById('draw10-overlay').classList.add('hidden'); showView('detail');" class="fixed top-4 right-4 z-[80] bg-white/10 hover:bg-white/20 text-white p-3 rounded-full border border-white/20 transition-all">
            <i data-lucide="x" class="w-6 h-6 md:w-7 md:h-7"></i>
        </button>        
        <div class="relative z-10 w-full max-w-4xl mx-auto p-4 py-8 md:py-12 min-h-full flex items-center">
            <div class="w-full bg-gradient-to-r from-purple-600 to-pink-600 p-1 border-4 border-black shadow-large container-safe">
                <div class="bg-white p-4 md:p-8 border-2 border-black">
                    <h2 class="text-2xl md:text-4xl font-black text-center mb-2 italic uppercase bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">10ÈÄ£ÊäΩÁµêÊûú</h2>
                    <p class="text-center text-gray-500 font-bold mb-4 md:mb-6 text-xs md:text-base">10 CONSECUTIVE DRAWS RESULT</p>
                    
                    <div id="draw10-results" class="grid grid-cols-2 md:grid-cols-5 gap-2 md:gap-4 mb-4 md:mb-6">
                        <!-- ÁµêÊûúÂ∞áÂãïÊÖãÂ°´ÂÖÖ -->
                    </div>
                    
                    <div id="draw10-summary" class="bg-gradient-to-r from-purple-100 to-pink-100 border-2 border-black p-3 md:p-5 mb-4 md:mb-6">
                        <h3 class="font-black text-base md:text-xl mb-2 md:mb-3 uppercase">ÊäΩÁçéÁµ±Ë®à</h3>
                        <div id="draw10-stats" class="grid grid-cols-2 md:grid-cols-3 gap-2 md:gap-3">
                            <!-- Áµ±Ë®àÂ∞áÂãïÊÖãÂ°´ÂÖÖ -->
                        </div>
                    </div>
                      <div class="flex flex-col md:flex-row gap-2 md:gap-3">
                        <button onclick="startDraw(10)" class="flex-1 bg-gradient-to-r from-purple-600 to-pink-600 text-white font-black py-3 md:py-4 text-base md:text-xl border-3 border-black shadow-[4px_4px_0px_rgba(0,0,0,1)] hover:translate-y-[-2px] transition-all flex items-center justify-center gap-2">
                            <i data-lucide="zap" class="w-4 h-4 md:w-6 md:h-6"></i> ÂÜçÊäΩ10ÈÄ£
                        </button>
                        <button onclick="startDraw(1)" class="flex-1 btn-anime py-3 md:py-4 text-base md:text-xl">
                            ÂñÆÊäΩÊ®°Âºè
                        </button>
                        <button onclick="showView('list')" class="bg-black textÁôΩËâ≤ font-black py-3 md:py-4 px-4 md:px-6 text-xs md:text-base uppercase border-2 border-white">ËøîÂõûÂ§ßÂª≥</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>        const MOCK_DATA = [
            { 
                id: 1, 
                title: "ÈæçÁè†ÔºöÊ•µÊÑèÂÜçÁèæ", 
                price: 350, 
                total: 80, 
                sold: 74, 
                image: "https://kujiflip.tw/uploads/1764866651737.jpg", 
                tags: ["ÁÜ±ÈñÄ", "Ââ© 6 ÊäΩ"], 
                status: "HOT", 
                prizes: { 
                    A: { name: "Ëá™Âú®Ê•µÊÑèÂäü ÊÇüÁ©∫", left: 1, total: 2, icon: "üî•", value: 8000 }, 
                    B: { name: "ÈôêÂÆöÁ´ãÁâå", left: 2, total: 5, icon: "üñºÔ∏è", value: 1500 },
                    C: { name: "ÁâπË£ΩÈ¶¨ÂÖãÊùØ", left: 3, total: 8, icon: "‚òï", value: 800 },
                    D: { name: "Â£ìÂÖãÂäõÂêäÈ£æ", left: 0, total: 15, icon: "üé™", value: 300 },
                    E: { name: "Ëø∑‰Ω†ÂÖ¨‰ªî", left: 0, total: 25, icon: "üé≠", value: 200 },
                    F: { name: "Ë≤ºÁ¥ôÁµÑ", left: 0, total: 25, icon: "üìã", value: 100 }
                } 
            },
            { 
                id: 2, 
                title: "[Êó•Áâà] ‰∏ÄÁï™Ë≥û „ÄäÊàëÁöÑËã±ÈõÑÂ≠∏Èô¢„Äã-Êõ¥ÂêëÂâçÈÇÅÈÄ≤", 
                price: 300, 
                total: 80, 
                sold: 12, 
                image: "https://firebasestorage.googleapis.com/v0/b/kuji-96189.appspot.com/o/1762847771147.jpg.webp?alt=media", 
                tags: ["NEW", "AË≥ûÂú®"], 
                status: "NEW", 
                prizes: { 
                    A: { name: "ÂÆâÂ¶Æ‰∫ûÊ®°Âûã", left: 3, total: 3, icon: "ü•ú", value: 6000 }, 
                    B: { name: "‰∏ªÈ°åÊéõËª∏", left: 5, total: 5, icon: "üìÅ", value: 2000 },
                    C: { name: "ÈÄ†ÂûãÊä±Êûï", left: 10, total: 10, icon: "üõèÔ∏è", value: 1200 },
                    D: { name: "ÂæΩÁ´†Â•óÁµÑ", left: 15, total: 15, icon: "üèÖ", value: 500 },
                    E: { name: "Êñá‰ª∂Â§æ", left: 22, total: 22, icon: "üìÇ", value: 250 },
                    F: { name: "Êòé‰ø°ÁâáÁµÑ", left: 25, total: 25, icon: "‚úâÔ∏è", value: 150 }
                } 
            },
            { 
                id: 3, 
                title: "‰∏ÄÁï™Ë≥û„ÄäËà™Êµ∑Áéã„ÄãÊú™‰æÜÂ≥∂ ÔΩûËÉΩÈáèÁàÜÁôº", 
                price: 280, 
                total: 100, 
                sold: 92, 
                image: "https://kujiflip.tw/uploads/1764041306128.jpg", 
                tags: ["Á∑äÊÄ•", "Ââ© 8 ÊäΩ"], 
                status: "ALERT", 
                prizes: { 
                    A: { name: "‰∫îÊ¢ùÊÇüÊ®°Âûã", left: 1, total: 1, icon: "üßø", value: 12000 }, 
                    B: { name: "ÊØõÂ∑æÁµÑ", left: 2, total: 5, icon: "üß£", value: 800 },
                    C: { name: "ÊâãËæ¶ÈÖç‰ª∂", left: 1, total: 10, icon: "‚ö°", value: 600 },
                    D: { name: "Êµ∑Â†±Â•óÁµÑ", left: 2, total: 20, icon: "üé®", value: 400 },
                    E: { name: "Èë∞ÂåôÂúà", left: 2, total: 30, icon: "üîë", value: 200 },
                    F: { name: "Âç°ÁâáÁµÑ", left: 0, total: 34, icon: "üÉè", value: 100 }
                } 
            },
            { 
                id: 4, 
                title: "ÔºÅ‰∏ÄÁï™Ë≥û„ÄäSPY√óFAMILY ÈñìË´úÂÆ∂ÂÆ∂ÈÖí„Äã-Get ready to have fun!", 
                price: 250, 
                total: 80, 
                sold: 40, 
                image: "https://firebasestorage.googleapis.com/v0/b/kuji-96189.appspot.com/o/1764076262223.jpg.webp?alt=media", 
                tags: ["ÁâπÂÉπ", "ÂçäÊï∏Âú®"], 
                status: "EVENT", 
                prizes: { 
                    A: { name: "Âô¥ÁÅ´ÈæçÁé©ÂÅ∂", left: 2, total: 2, icon: "üî•", value: 5000 }, 
                    B: { name: "È§êÂÖ∑ÁµÑ", left: 3, total: 5, icon: "üç¥", value: 1800 },
                    C: { name: "Êî∂Á¥çÁõí", left: 8, total: 10, icon: "üì¶", value: 900 },
                    D: { name: "ÊùØÂ¢äÁµÑ", left: 10, total: 18, icon: "üéØ", value: 400 },
                    E: { name: "‰æøÊ¢ùÁ¥ô", left: 12, total: 20, icon: "üìù", value: 250 },
                    F: { name: "ÈÄèÊòéÂç°", left: 5, total: 25, icon: "üíé", value: 150 }
                } 
            }
        ];        let currentKuji = null, drawnPrize = null, selectedIndex = 0, drawCount = 1;

        // ============ Âø´ÈÄüÂãùÂà©ÂåÖÔºöÊï∏ÊìöÁÆ°ÁêÜ ============
        
        // ‰øùÂ∫ïÁ≥ªÁµ±
        const PITY_SYSTEM = {
            maxDraws: 50, // 50ÊäΩ‰øùÂ∫ï
            getCurrentCount: function(kujiId) {
                const pity = JSON.parse(localStorage.getItem('pitySystem') || '{}');
                return pity[kujiId] || 0;
            },
            increment: function(kujiId) {
                const pity = JSON.parse(localStorage.getItem('pitySystem') || '{}');
                pity[kujiId] = (pity[kujiId] || 0) + 1;
                localStorage.setItem('pitySystem', JSON.stringify(pity));
                return pity[kujiId];
            },
            reset: function(kujiId) {
                const pity = JSON.parse(localStorage.getItem('pitySystem') || '{}');
                pity[kujiId] = 0;
                localStorage.setItem('pitySystem', JSON.stringify(pity));
            },
            getRemaining: function(kujiId) {
                return this.maxDraws - this.getCurrentCount(kujiId);
            },
            getProgress: function(kujiId) {
                return (this.getCurrentCount(kujiId) / this.maxDraws) * 100;
            }
        };        // Ê≠∑Âè≤Ë®òÈåÑÁ≥ªÁµ±Â∑≤ÁßªÈô§

        // Êî∂ËóèÁ≥ªÁµ±
        const FAVORITE_SYSTEM = {
            toggle: function(kujiId) {
                const favs = this.getAll();
                const index = favs.indexOf(kujiId);
                if (index > -1) {
                    favs.splice(index, 1);
                } else {
                    favs.push(kujiId);
                }
                localStorage.setItem('favorites', JSON.stringify(favs));
                return favs.includes(kujiId);
            },
            isFavorite: function(kujiId) {
                return this.getAll().includes(kujiId);
            },
            getAll: function() {
                return JSON.parse(localStorage.getItem('favorites') || '[]');
            },
            getFavoriteKujis: function() {
                const favIds = this.getAll();
                return MOCK_DATA.filter(k => favIds.includes(k.id));
            }
        };

        // Ë®àÁÆóÊ©üÁéáËºîÂä©ÂáΩÊï∏
        function calculateProbability(kuji) {
            const remaining = kuji.total - kuji.sold;
            const stats = {};
            
            Object.entries(kuji.prizes).forEach(([rank, prize]) => {
                const prob = remaining > 0 ? (prize.left / remaining * 100) : 0;
                stats[rank] = {
                    ...prize,
                    probability: prob,
                    odds: remaining > 0 ? `1/${Math.round(remaining / Math.max(prize.left, 1))}` : '0'
                };
            });
            
            return stats;
        }

        // Ë®àÁÆóÊúüÊúõÂÄº
        function calculateExpectedValue(kuji) {
            const stats = calculateProbability(kuji);
            let expectedValue = 0;
            
            Object.values(stats).forEach(prize => {
                expectedValue += (prize.probability / 100) * prize.value;
            });
            
            return Math.round(expectedValue);
        }

        function showView(name) {
            const content = document.getElementById('app-content');
            document.querySelectorAll('.fixed').forEach(el => el.classList.add('hidden'));
            document.body.classList.remove('no-scroll');
            if (name === 'list') renderList(content);
            else if (name === 'detail') renderDetail(content);
            lucide.createIcons();
            window.scrollTo(0,0);
        }        function renderList(container) {            const hotKuji = MOCK_DATA[0];
            const hotStats = calculateProbability(hotKuji);
            const hotEV = calculateExpectedValue(hotKuji);
            const favorites = FAVORITE_SYSTEM.getFavoriteKujis();
            
            container.innerHTML = `
                <div class="space-y-10 animate-fade-in pb-16">
                    
                    <!-- ‚ù§Ô∏è ÊàëÁöÑÊî∂Ëóè -->
                    ${favorites.length > 0 ? `
                    <section class="space-y-4">
                        <div class="flex items-center justify-between px-1">
                            <h3 class="text-2xl md:text-3xl font-black italic flex items-center gap-2 uppercase tracking-tighter">
                                <i data-lucide="heart" class="w-6 h-6 text-red-500 fill-current"></i> ÊàëÁöÑÊî∂Ëóè
                            </h3>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            ${favorites.map(kuji => {
                                const stats = calculateProbability(kuji);
                                const ev = calculateExpectedValue(kuji);
                                const pityRemaining = PITY_SYSTEM.getRemaining(kuji.id);
                                const isFav = FAVORITE_SYSTEM.isFavorite(kuji.id);
                                return `
                                <div onclick="selectKuji(${kuji.id})" class="bg-white border-2 border-black shadow-[5px_5px_0px_rgba(0,0,0,1)] cursor-pointer hover:-translate-y-1 transition-all">
                                    <div class="flex h-32 md:h-40">
                                        <div class="w-1/3 overflow-hidden border-r-2 border-black">
                                            <img src="${kuji.image}" class="w-full h-full object-cover">
                                        </div>
                                        <div class="w-2/3 p-3 md:p-4 flex flex-col justify-between">
                                            <div>
                                                <h4 class="font-black text-base md:text-lg italic truncate text-black uppercase">${kuji.title}</h4>
                                                <div class="text-xs md:text-sm text-gray-500 mt-1">‰øùÂ∫ïÂâ©È§ò: ${pityRemaining} ÊäΩ</div>
                                            </div>
                                            <div class="flex justify-between items-end">
                                                <div class="font-bebas text-3xl md:text-4xl text-black">NT$${kuji.price}</div>
                                                <button onclick="event.stopPropagation(); toggleFavorite(${kuji.id})" class="text-red-500 hover:scale-110 transition-transform">
                                                    <i data-lucide="heart" class="w-5 h-5 md:w-6 md:h-6 fill-current"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `}).join('')}
                        </div>
                    </section>                    ` : ''}
                      <!-- Á≤æÈÅ∏Â§ßÁúãÊùø -->
                    <section class="relative bg-red-600 border-4 border-black p-1 shadow-[4px_4px_0px_rgba(0,0,0,1)] md:shadow-[8px_8px_0px_rgba(0,0,0,1)] cursor-pointer group mr-1 md:mr-2" onclick="selectKuji(${hotKuji.id})">
                        <div class="speed-lines absolute inset-0 opacity-20"></div>
                        <div class="relative bg-white flex flex-col h-full border-2 border-black">
                            <!-- ÂúñÁâáËàáÂü∫Êú¨Ë≥áË®ä -->
                            <div class="flex flex-col md:flex-row">
                                <div class="md:w-1/2 h-56 md:h-80 overflow-hidden border-b-2 md:border-b-0 md:border-r-2 border-black">
                                    <img src="${hotKuji.image}" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-700">
                                </div>
                                <div class="md:w-1/2 p-6 md:p-8 flex flex-col justify-between bgÁôΩ relative">
                                    <div class="absolute -right-4 top-4 rotate-12 bg-red-600 text-white font-black px-5 py-2 text-sm md:text-base skew-box shadow-lg">HOT BOARD</div>
                                    <div>
                                        <span class="bg-black text-yellow-400 font-black px-3 py-1.5 text-sm md:text-base italic skew-box inline-block mb-4"><span class="unskew">RECOMMENDED</span></span>
                                        <h2 class="text-black font-black text-3xl md:text-5xl italic leading-none uppercase tracking-tighter mb-3">${hotKuji.title}</h2>
                                        <p class="text-gray-400 text-base md:text-lg font-bold mb-4 uppercase">ÂÉÖÂâ© ${hotKuji.total - hotKuji.sold} ÊäΩ ‚Ä¢ Â§ßÁçéÂú®ÁÆ±</p>
                                    </div>                                    <div class="flex items-end justify-between">
                                        <div>
                                            <div class="font-black font-bebas text-5xl md:text-6xl text-red-600">NT$${hotKuji.price}</div>
                                            <div class="text-base md:text-lg text-gray-500 font-bold mt-1">ÊúüÊúõÂÄº: NT$${hotEV}</div>
                                        </div>
                                        <button onclick="event.stopPropagation(); selectKuji(${hotKuji.id});" class="btn-anime px-8 md:px-10 py-2.5 md:py-3 text-base md:text-lg whitespace-nowrap">Á´ãÂç≥ÈñãÊäΩ</button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Ê©üÁéáÂàÜÊûêÂçÄ -->
                            <div class="border-t-2 border-black bg-gray-50 p-4 md:p-6">
                                <div class="flex items-center gap-2 mb-4">
                                    <span class="text-base md:text-lg font-black text-gray-600 uppercase tracking-wider">Áï∂ÂâçÊ©üÁéáÂàÜÊûê</span>
                                    <div class="flex-1 h-px bg-gray-300"></div>
                                </div>
                                <div class="grid grid-cols-3 md:grid-cols-6 gap-3">
                                    ${Object.entries(hotStats).map(([rank, prize]) => `
                                        <div class="bg-white border border-black p-3 md:p-4 text-center ${prize.left === 0 ? 'opacity-40' : ''}">
                                            <div class="text-3xl md:text-4xl mb-2">${prize.icon}</div>
                                            <div class="font-black text-base md:text-lg text-black mb-2">${rank} Ë≥û</div>
                                            <div class="text-sm md:text-base font-bold ${prize.left > 0 ? 'text-green-600' : 'text-red-600'}">
                                                ${prize.left > 0 ? prize.probability.toFixed(1) + '%' : 'Â∑≤ÊäΩÂÆå'}
                                            </div>
                                            <div class="text-sm md:text-base text-gray-400 mt-1">${prize.left}/${prize.total}</div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    </section>
                    
                    <!-- ÈÄüÊäΩÂ∞àÂçÄ -->
                    <section class="space-y-4">
                        <div class="flex items-center justify-between px-1">
                            <h3 class="text-2xl md:text-3xl font-black italic flex items-center gap-2 uppercase tracking-tighter">
                                <span class="w-2 h-6 bg-cyan-400 skew-box"></span> Quick Picks
                            </h3>
                            <span class="text-sm md:text-base text-gray-500 font-bold uppercase tracking-widest">Swipe for more</span>
                        </div>
                        <div class="flex gap-4 overflow-x-auto scrollbar-hide pb-4 px-1">
                            ${MOCK_DATA.slice(1, 4).map(kuji => {
                                const stats = calculateProbability(kuji);
                                const topPrizes = Object.entries(stats).slice(0, 3);
                                return `
                                <div onclick="selectKuji(${kuji.id})" class="flex-shrink-0 w-72 md:w-80 bg-white border-2 border-black shadow-[4px_4px_0px_rgba(0,0,0,1)] cursor-pointer hover:translate-y-[-2px] transition-all">
                                    <div class="h-40 md:h-48 overflow-hidden border-b-2 border-black relative">
                                        <img src="${kuji.image}" class="w-full h-full object-cover">
                                        <div class="absolute top-2 left-2 bg-yellow-400 text-black font-black text-sm md:text-base px-3 py-1.5 border border-black">${kuji.tags[0]}</div>
                                    </div>
                                    <div class="p-4 md:p-5">
                                        <h4 class="font-black text-lg md:text-xl italic truncate text-black uppercase mb-3">${kuji.title}</h4>
                                        <div class="flex gap-2 mt-2 mb-4">
                                            ${topPrizes.map(([rank, prize]) => `
                                                <div class="flex-1 bg-gray-100 p-2 md:p-3 text-center border border-gray-200">
                                                    <div class="text-2xl md:text-3xl">${prize.icon}</div>
                                                    <div class="text-sm md:text-base font-bold text-black mt-1">${rank}</div>
                                                    <div class="text-sm md:text-base ${prize.left > 0 ? 'text-green-600' : 'text-red-500'} font-bold">
                                                        ${prize.left > 0 ? prize.probability.toFixed(0) + '%' : 'ÂÆå'}
                                                    </div>
                                                </div>
                                            `).join('')}
                                        </div>
                                        <div class="flex justify-between items-center">
                                            <span class="font-bebas text-3xl md:text-4xl text-black">NT$${kuji.price}</span>
                                            <button onclick="event.stopPropagation(); selectKuji(${kuji.id});" class="bg-black text-yellow-400 font-black px-4 py-2 text-sm md:text-base border-2 border-yellow-400 hover:bg-yellow-400 hover:text-black transition-all">Á´ãÂç≥ÈñãÊäΩ</button>
                                        </div>
                                    </div>
                                </div>
                            `}).join('')}
                        </div>
                    </section>
                    
                    <!-- ÊâÄÊúâÁúãÊùø -->
                    <section class="space-y-6">
                        <div class="flex items-center gap-2 px-1">
                            <h3 class="text-2xl md:text-3xl font-black italic flex items-center gap-2 uppercase tracking-tighter">
                                <span class="w-2 h-6 bg-yellow-400 skew-box"></span> All Boards
                            </h3>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            ${MOCK_DATA.map(kuji => {
                                const stats = calculateProbability(kuji);
                                const ev = calculateExpectedValue(kuji);
                                return `
                                <div onclick="selectKuji(${kuji.id})" class="bg-white border-2 border-black shadow-[5px_5px_0px_rgba(0,0,0,1)] cursor-pointer flex flex-col group transition-all hover:-translate-y-1">
                                    <div class="flex h-40 md:h-48">
                                        <div class="w-1/3 overflow-hidden border-r-2 border-black">
                                            <img src="${kuji.image}" class="w-full h-full object-cover group-hover:scale-110 transition-transform">
                                        </div>
                                        <div class="w-2/3 p-4 md:p-5 flex flex-col justify-between relative bg-white">
                                            <div>
                                                <div class="flex justify-between items-start mb-2">
                                                    <h4 class="font-black text-lg md:text-2xl italic truncate text-black pr-2 uppercase">${kuji.title}</h4>
                                                    <span class="text-xs md:text-sm font-black bg-red-100 text-red-600 px-2.5 py-1 border border-red-200 uppercase whitespace-nowrap">${kuji.status}</span>
                                                </div>
                                                <div class="flex gap-2 flex-wrap">
                                                    ${kuji.tags.map(t => `<span class="text-sm md:text-base font-bold text-gray-400 uppercase border border-gray-100 px-2.5 py-1">${t}</span>`).join('')}
                                                </div>
                                            </div>
                                            <div class="flex justify-between items-end border-t border-gray-100 pt-3 mt-2">
                                                <div>
                                                    <div class="font-bebas text-4xl md:text-5xl text-black">NT$${kuji.price}</div>
                                                    <div class="text-sm md:text-base text-gray-500">EV: ${ev} | Ââ©${kuji.total - kuji.sold}ÊäΩ</div>
                                                </div>
                                                <button onclick="event.stopPropagation(); selectKuji(${kuji.id});" class="bg-black text-yellow-400 font-black px-4 py-2 text-sm md:text-base border-2 border-yellow-400 hover:bg-yellow-400 hover:text-black transition-all whitespace-nowrap">Á´ãÂç≥ÈñãÊäΩ</button>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Âø´ÈÄüÊ©üÁéáÈ†êË¶Ω -->
                                    <div class="border-t-2 border-black bg-gray-50 p-3 flex gap-1">
                                        ${Object.entries(stats).slice(0, 4).map(([rank, prize]) => `
                                            <div class="flex-1 text-center">
                                                <div class="text-sm md:text-base font-black text-black">${rank}</div>
                                                <div class="text-sm md:text-base ${prize.left > 0 ? 'text-green-600' : 'text-red-500'} font-bold">
                                                    ${prize.left > 0 ? prize.probability.toFixed(0) + '%' : '‚úï'}
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            `}).join('')}
                        </div>
                    </section>
                </div>
            `;
        }        function renderDetail(container) {
            const stats = calculateProbability(currentKuji);
            const ev = calculateExpectedValue(currentKuji);
            const remaining = currentKuji.total - currentKuji.sold;
            const pityCount = PITY_SYSTEM.getCurrentCount(currentKuji.id);
            const pityRemaining = PITY_SYSTEM.getRemaining(currentKuji.id);
            const pityProgress = PITY_SYSTEM.getProgress(currentKuji.id);
            const isFavorite = FAVORITE_SYSTEM.isFavorite(currentKuji.id);
            
            // ÁîüÊàêÁçéÂìÅÂàÜÊûêHTML
            let prizesHTML = '';
            Object.entries(stats).forEach(([rank, prize]) => {
                const progressWidth = (prize.left / prize.total) * 100;
                const borderColor = prize.left > 0 ? 'border-yellow-400' : 'border-gray-400';
                const statusColor = prize.left > 0 ? 'text-green-600' : 'text-red-600';
                const statusText = prize.left > 0 ? progressWidth.toFixed(1) + '% Ââ©È§ò' : 'ÂÆåÂîÆ';
                const barColor = prize.left > 0 ? 'bg-green-500' : 'bg-red-500';
                const probText = prize.left > 0 ? prize.probability.toFixed(2) + '%' : '0%';
                
                prizesHTML += '<div class="mb-5 pb-5 border-b border-gray-200 last:border-0">';
                prizesHTML += '  <div class="flex items-center justify-between mb-3">';
                prizesHTML += '    <div class="flex items-center gap-3">';
                prizesHTML += '      <div class="w-14 h-14 md:w-16 md:h-16 bg-black flex items-center justify-center text-3xl md:text-4xl border-2 ' + borderColor + '">';
                prizesHTML += '        ' + prize.icon;
                prizesHTML += '      </div>';
                prizesHTML += '      <div>';
                prizesHTML += '        <div class="flex items-center gap-2">';
                prizesHTML += '          <span class="text-2xl md:text-3xl font-black italic text-black">' + rank + ' Ë≥û</span>';
                if (prize.left === 0) {
                    prizesHTML += '          <span class="text-xs md:text-sm fontÈªë bg-red-100 text-red-600 px-3 py-1 border border-red-200">Â∑≤ÂÆåÂîÆ</span>';
                }
                prizesHTML += '        </div>';
                prizesHTML += '        <div class="text-base md:text-lg font-black text-gray-700 uppercase">' + prize.name + '</div>';
                prizesHTML += '      </div>';
                prizesHTML += '    </div>';
                prizesHTML += '    <div class="text-right">';
                prizesHTML += '      <div class="text-xs md:text-sm font-black text-gray-500">ÂÉπÂÄº</div>';
                prizesHTML += '      <div class="font-bebas text-xl md:text-2xl text-black">NT$' + prize.value + '</div>';
                prizesHTML += '    </div>';
                prizesHTML += '  </div>';
                prizesHTML += '  <div class="mb-3">';
                prizesHTML += '    <div class="flex justify-between text-xs md:text-sm font-bold mb-2">';
                prizesHTML += '      <span class="text-gray-600">Ââ©È§ò ' + prize.left + ' / ' + prize.total + '</span>';
                prizesHTML += '      <span class="' + statusColor + '">' + statusText + '</span>';
                prizesHTML += '    </div>';
                prizesHTML += '    <div class="w-full h-3 bg-gray-200 border border-black overflow-hidden">';
                prizesHTML += '      <div class="h-full ' + barColor + ' transition-all duration-500" style="width: ' + progressWidth + '%"></div>';
                prizesHTML += '    </div>';
                prizesHTML += '  </div>';
                prizesHTML += '  <div class="grid grid-cols-3 gap-2 md:gap-3 mt-3">';
                prizesHTML += '    <div class="bg-gray-50 border border-gray-200 p-3 text-center">';
                prizesHTML += '      <div class="text-xs md:text-sm text-gray-500 font-bold uppercase mb-1">Áï∂ÂâçÊ©üÁéá</div>';
                prizesHTML += '      <div class="font-black ' + statusColor + ' text-base md:text-lg">' + probText + '</div>';
                prizesHTML += '    </div>';
                prizesHTML += '    <div class="bg-gray-50 border border-gray-200 p-3 text-center">';
                prizesHTML += '      <div class="text-xs md:text-sm text-gray-500 font-bold uppercase mb-1">‰∏≠ÁçéÁéá</div>';
                prizesHTML += '      <div class="font-black text-black text-base md:text-lg">' + prize.odds + '</div>';
                prizesHTML += '    </div>';
                prizesHTML += '    <div class="bg-gray-50 border border-gray-200 p-3 text-center">';
                prizesHTML += '      <div class="text-xs md:text-sm text-gray-500 font-bold uppercase mb-1">ÂéüÂßãÊ©üÁéá</div>';
                prizesHTML += '      <div class="font-black text-gray-600 text-base md:text-lg">' + (prize.total / currentKuji.total * 100).toFixed(1) + '%</div>';
                prizesHTML += '    </div>';                prizesHTML += '  </div>';
                prizesHTML += '</div>';
            });
            
            // ‰øùÂ∫ïË≠¶Â†±HTML
            let pityAlertHTML = '';
            if (pityRemaining <= 10) {
                pityAlertHTML = '<div class="bg-gradient-to-r from-purple-100 to-pink-100 border-2 border-purple-300 p-3 mb-4 text-center">';
                pityAlertHTML += '  <div class="text-xs md:text-sm font-black text-purple-600 uppercase">‚ö° ‰øùÂ∫ïË≠¶Â†±</div>';
                pityAlertHTML += '  <div class="text-lg md:text-xl font-black text-purple-800">ÈÇÑÂ∑Æ ' + pityRemaining + ' ÊäΩÂøÖÂæó A Ë≥ûÔºÅ</div>';
                pityAlertHTML += '</div>';
            }
            
            const evColor = ev > currentKuji.price ? 'text-green-600' : 'text-red-600';
            const evTip = ev > currentKuji.price ? '‚úì ÊúüÊúõÂÄºÂ§ßÊñºÂñÆÊäΩÂÉπÊ†º' : '‚ö† ÊúüÊúõÂÄºÂ∞èÊñºÂñÆÊäΩÂÉπÊ†º';
            const favColor = isFavorite ? 'text-red-500' : 'text-gray-300';
            const favFill = isFavorite ? 'fill-current' : '';
              container.innerHTML = '<div class="flex flex-col gap-6 animate-slide-up">' +
                '<!-- üìä Á∞°ÂåñË≥áË®äÂç°Áâá -->' +
                '<div class="grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4">' +
                  '<div class="bg-white border-2 border-black p-4 md:p-6 shadow-[3px_3px_0px_rgba(0,0,0,1)]">' +
                    '<div class="text-xs font-bold text-gray-500 uppercase mb-1">ÂñÆÊäΩ</div>' +
                    '<div class="font-bebas text-3xl md:text-5xl text-black">$' + currentKuji.price + '</div>' +
                  '</div>' +
                  '<div class="bg-white border-2 border-black p-4 md:p-6 shadow-[3px_3px_0px_rgba(0,0,0,1)]">' +
                    '<div class="text-xs font-bold text-gray-500 uppercase mb-1">ÊúüÊúõ</div>' +
                    '<div class="font-bebas text-3xl md:text-5xl ' + evColor + '">$' + ev + '</div>' +
                  '</div>' +
                  '<div class="bg-white border-2 border-black p-4 md:p-6 shadow-[3px_3px_0px_rgba(0,0,0,1)]">' +
                    '<div class="text-xs font-bold text-gray-500 uppercase mb-1">Ââ©È§ò</div>' +
                    '<div class="font-bebas text-3xl md:text-5xl text-black">' + remaining + '<span class="text-xl md:text-2xl text-gray-400">/' + currentKuji.total + '</span></div>' +
                  '</div>' +
                  '<div class="bg-slate-800 border-2 border-black p-4 md:p-6 shadow-[3px_3px_0px_rgba(0,0,0,1)]">' +
                    '<div class="text-xs font-bold text-gray-400 uppercase mb-1">‰øùÂ∫ï</div>' +
                    '<div class="font-bebas text-3xl md:text-5xl textÁôΩ">' + pityRemaining + '</div>' +
                    '<div class="w-full bg-gray-700 h-1.5 mt-2 overflow-hidden">' +
                      '<div class="h-full bg-yellow-400 transition-all duration-500" style="width: ' + pityProgress + '%"></div>' +
                    '</div>' +
                    '<div class="text-xs text-gray-400 mt-1">' + pityCount + '/' + PITY_SYSTEM.maxDraws + '</div>' +
                  '</div>' +
                '</div>' +
                
                '<div class="flex flex-col md:flex-row gap-4 md:gap-6">' +
                  '<!-- üéØ Â∑¶ÂÅ¥ÔºöÂúñÁâá+ÊäΩÁçéÊåâÈàïÂçÄ -->' +
                  '<div class="md:w-5/12">' +
                    '<div class="bg-white border-3 border-black p-4 md:p-6 shadow-[6px_6px_0px_rgba(0,0,0,1)] sticky top-20">' +
                      '<button onclick="event.stopPropagation(); toggleFavorite(' + currentKuji.id + ')" class="absolute top-3 right-3 z-10 ' + favColor + ' hover:scale-110 transition-transform">' +
                        '<i data-lucide="heart" class="w-6 h-6 md:w-7 md:h-7 ' + favFill + '"></i>' +
                      '</button>' +
                      
                      '<!-- ÂúñÁâá -->' +
                      '<img src="' + currentKuji.image + '" class="w-full h-48 md:h-64 object-cover border-2 border-black mb-3">' +
                      
                      '<!-- Ê®ôÈ°å -->' +
                      '<h2 class="text-xl md:text-2xl font-black text-black italic mb-3 uppercase tracking-tight pr-8">' + currentKuji.title + '</h2>' +
                      
                      pityAlertHTML +
                      
                      '<!-- Ââ©È§òÊï∏ÈáèÂç°Áâá -->' +
                      '<div class="bg-slate-800 text-white p-3 md:p-4 mb-4 border-2 border-black">' +
                        '<div class="flex justify-between items-center">' +
                          '<span class="text-xs font-bold text-gray-400 uppercase">Ââ©È§ò</span>' +
                          '<span class="text-2xl md:text-3xl font-black text-yellow-400 font-bebas">' + remaining + ' / ' + currentKuji.total + '</span>' +
                        '</div>' +
                      '</div>' +
                      
                      '<!-- üéØ Ë∂ÖÂ§ßÊäΩÁçéÊåâÈàïÂçÄ -->' +
                      '<div class="space-y-3 mb-4">' +
                        '<!-- ÂñÆÊäΩÊåâÈàïÔºöÈªÉËâ≤Ë∂ÖÂ§ß -->' +
                        '<button onclick="startDraw()" class="w-full bg-gradient-to-r from-yellow-400 to-yellow-500 hover:from-yellow-500 hover:to-yellow-600 text-black font-black py-6 md:py-7 text-2xl md:text-3xl border-4 border-black shadow-[6px_6px_0px_rgba(0,0,0,1)] hover:shadow-[3px_3px_0px_rgba(0,0,0,1)] hover:translate-x-[3px] hover:translate-y-[3px] transition-all uppercase tracking-tight flex items-center justify-center gap-3">' +
                          '<span class="text-4xl">üé´</span>' +
                          '<div class="text-left leading-tight">' +
                            '<div class="text-sm font-bold opacity-90">SINGLE</div>' +
                            '<div class="text-3xl md:text-4xl">ÂñÆÊäΩ $' + currentKuji.price + '</div>' +
                          '</div>' +
                        '</button>' +
                        
                        '<!-- 10ÈÄ£ÊäΩÊåâÈàïÔºöÁ¥ÖËâ≤Â§ßÊåâÈàï -->' +
                        '<button onclick="startDraw(10)" class="w-full bg-gradient-to-r from-red-600 to-pink-600 hover:from-red-700 hover:to-pink-700 text-white font-black py-5 md:py-6 text-xl md:text-2xl border-4 border-black shadow-[6px_6px_0px_rgba(0,0,0,1)] hover:shadow-[3px_3px_0px_rgba(0,0,0,1)] hover:translate-x-[3px] hover:translate-y-[3px] transition-all uppercase tracking-tight flex items-center justify-center gap-3">' +
                          '<span class="text-3xl">üéÅ</span>' +
                          '<div class="text-left leading-tight">' +
                            '<div class="text-xs font-bold opacity-90">10x COMBO</div>' +
                            '<div class="text-2xl md:text-3xl">$' + (currentKuji.price * 10) + '</div>' +
                          '</div>' +
                        '</button>' +
                      '</div>' +
                      
                      '<!-- ÊèêÁ§∫ÊñáÂ≠ó -->' +
                      '<div class="text-center text-xs text-gray-500 font-bold bg-gray-50 py-2 border border-gray-200 rounded">' + evTip + '</div>' +
                    '</div>' +
                  '</div>' +
                  
                  '<!-- Âè≥ÂÅ¥ÔºöÊ©üÁéáÂàÜÊûê -->' +
                  '<div class="flex-1 space-y-4">' +
                    '<div class="bg-white border-2 border-black p-5 md:p-6 shadow-[4px_4px_0px_rgba(0,0,0,1)]">' +
                      '<h3 class="text-xl md:text-2xl font-black italic border-l-4 border-yellow-400 pl-3 uppercase mb-5 tracking-tighter flex items-center justify-between">' +
                        '<span>ÂÆåÊï¥Ê©üÁéáÂàÜÊûê</span>' +
                        '<span class="text-xs md:text-sm text-gray-500 font-normal normal-case">Updated Real-time</span>' +
                      '</h3>' +
                      prizesHTML +
                    '</div>' +
                    '<div class="bg-gradient-to-r from-yellow-400 to-yellow-300 border-2 border-black p-5 md:p-6 shadow-[4px_4px_0px_rgba(0,0,0,1)]">' +
                      '<h4 class="text-base md:text-lg font-black text-black mb-4 uppercase">üí° Áµ±Ë®àÊëòË¶Å</h4>' +
                      '<div class="grid grid-cols-2 gap-3 md:gap-4">' +
                        '<div class="bg-white/80 border border-black p-3 md:p-4">' +
                          '<div class="text-xs md:text-sm text-gray-600 font-bold uppercase mb-1">Á∏ΩË≥ûÂìÅÊï∏</div>' +
                          '<div class="font-bebas text-3xl md:text-4xl text-black">' + Object.keys(stats).length + '</div>' +
                        '</div>' +
                        '<div class="bg-white/80 border border-black p-3 md:p-4">' +
                          '<div class="text-xs md:text-sm text-gray-600 font-bold uppercase mb-1">Â∑≤ÂîÆÂá∫</div>' +
                          '<div class="font-bebas text-3xl md:text-4xl text-black">' + currentKuji.sold + '</div>' +
                        '</div>' +
                        '<div class="bg-white/80 border border-black p-3 md:p-4">' +
                          '<div class="text-xs md:text-sm text-gray-600 font-bold uppercase mb-1">Â§ßË≥ûÊ©üÁéá</div>' +
                          '<div class="font-bebas text-3xl md:text-4xl ' + (stats.A.left > 0 ? 'text-green-600' : 'text-red-600') + '">' + (stats.A.left > 0 ? stats.A.probability.toFixed(1) + '%' : 'ÂÆåÂîÆ') + '</div>' +
                        '</div>' +
                        '<div class="bg-white/80 border border-black p-3 md:p-4">' +
                          '<div class="text-xs md:text-sm text-gray-600 font-bold uppercase mb-1">ÂÆåÂîÆË≥ûÂìÅ</div>' +
                          '<div class="font-bebas text-3xl md:text-4xl text-black">' + Object.values(stats).filter(p => p.left === 0).length + '</div>' +
                        '</div>' +
                      '</div>' +
                    '</div>' +
                  '</div>' +
                '</div>' +
              '</div>';
        }
        
        function selectKuji(id) {
            currentKuji = MOCK_DATA.find(x => x.id === id);
            showView('detail');
        }        function startDraw(count = 1) {
            drawCount = count;
            // ÈóúÈñâÊâÄÊúâÂèØËÉΩÈñãÂïüÁöÑË¶ÜËìãÂ±§
            document.getElementById('result-overlay').classList.add('hidden');
            document.getElementById('draw10-overlay').classList.add('hidden');
            // ÈñãÂïüÈÅ∏Á±§Êùø
            document.getElementById('selection-overlay').classList.remove('hidden');
            document.body.classList.add('no-scroll');
            renderTicketSelection();
        }function renderTicketSelection() {
            const carousel = document.getElementById('ticket-carousel');
            const label = document.getElementById('draw-type-label');
            carousel.innerHTML = '';
            
            // Êõ¥Êñ∞Ê®ôÁ±§È°ØÁ§∫
            if (drawCount === 10) {
                label.innerHTML = '10ÈÄ£ÊäΩÊ®°Âºè - ÈÄ£Á∫åÊäΩÂèñ10ÂºµÁ±§ÔºÅ';
            } else {
                label.innerHTML = 'ÈÅ∏Êìá‰Ω†ÁöÑÂπ∏ÈÅãÁ±§';
            }
              const ticketCount = drawCount === 10 ? 10 : 20;
            for (let i = 0; i < ticketCount; i++) {
                const ticket = document.createElement('div');
                ticket.className = 'ticket-card snap-center flex-shrink-0 w-36 h-52 md:w-40 md:h-56 flex flex-col items-center justify-between p-3 relative cursor-pointer';
                
                // ‰∏ÄÁï™Ë≥ûÁ±§Á¥ôÈ¢®Ê†ºÂÖßÂÆπ
                ticket.innerHTML = `
                    <!-- È†ÇÈÉ®LogoÂçÄ -->
                    <div class="w-full flex items-center justify-between">
                        <div class="bg-white/90 px-2 py-0.5 text-[10px] font-black text-red-600 border border-red-600">‰∏ÄÁï™Ë≥û</div>
                        <div class="bgÁôΩ/90 px-2 py-0.5 text-[10px] font-black text-red-600 border border-red-600">No.${String(i + 1).padStart(3, '0')}</div>
                    </div>
                    
                    <!-- ‰∏≠Â§ÆÂïèËôüÂçÄ -->
                    <div class="flex-1 flex items-center justify-center">
                        <div class="text-white font-black italic text-6xl md:text-7xl opacity-30 drop-shadow-lg" style="text-shadow: 2px 2px 4px rgba(0,0,0,0.3)">?</div>
                    </div>
                    
                    <!-- Â∫ïÈÉ®Ê¢ùÁ¢ºÂçÄ -->
                    <div class="w-full space-y-1">
                        <div class="bg-white/90 p-1.5 border border-white/50">
                            <div class="flex gap-[1px] h-8">
                                ${Array(12).fill(0).map(() => `<div class="flex-1 bg-black" style="opacity: ${Math.random() > 0.3 ? 1 : 0.3}"></div>`).join('')}
                            </div>
                        </div>
                        <div class="text-center text-[9px] font-mono font-bold text-white/90 tracking-wider bg-black/20 py-0.5">LOT ${1000 + i}</div>
                    </div>
                `;
                
                ticket.onclick = () => selectTicket(i);
                carousel.appendChild(ticket);
            }
            selectTicket(drawCount === 10 ? 0 : 4);
        }

        function selectTicket(index) {
            selectedIndex = index;
            const items = document.querySelectorAll('.ticket-card');
            items.forEach((item, i) => {
                item.classList.toggle('active', i === index);
                if (i === index) item.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
            });
        }

        function moveCarousel(dir) {
            selectedIndex = Math.max(0, Math.min(19, selectedIndex + dir));
            selectTicket(selectedIndex);
        }        function confirmSelection() {
            if (drawCount === 10) {
                // 10ÈÄ£ÊäΩÔºöÊäΩÂèñ10Ê¨°‰∏¶È°ØÁ§∫ÁµêÊûú
                const results = [];
                const ranks = Object.keys(currentKuji.prizes);
                let guaranteedA = false;
                
                for (let i = 0; i < 10; i++) {
                    // üéØ ‰øùÂ∫ïÊ©üÂà∂ÔºöÂ¢ûÂä†ÊäΩÊï∏‰∏¶Ê™¢Êü•ÊòØÂê¶Ëß∏Áôº‰øùÂ∫ï
                    const currentPity = PITY_SYSTEM.increment(currentKuji.id);
                    let rank;
                    
                    if (currentPity >= PITY_SYSTEM.maxDraws && !guaranteedA) {
                        // Ëß∏Áôº‰øùÂ∫ïÔºöÂº∑Âà∂Áµ¶AË≥û
                        rank = 'A';
                        guaranteedA = true;
                        PITY_SYSTEM.reset(currentKuji.id);
                    } else {
                        rank = ranks[Math.floor(Math.random() * ranks.length)];
                        // Â¶ÇÊûúÊäΩÂà∞AË≥ûÔºåÈáçÁΩÆ‰øùÂ∫ïË®àÊï∏
                        if (rank === 'A') {
                            PITY_SYSTEM.reset(currentKuji.id);
                        }
                    }
                      const p = currentKuji.prizes[rank];
                    const prize = { rank, name: p.name, icon: p.icon };
                    results.push(prize);
                }
                
                // ÂÑ≤Â≠òÁµêÊûú‰∏¶È°ØÁ§∫
                drawnPrize = results[0];
                sessionStorage.setItem('draw10Results', JSON.stringify(results));
                
                document.getElementById('selection-overlay').classList.add('hidden');
                show10DrawResults(results);
            } else {
                // ÂñÆÊäΩ
                // üéØ ‰øùÂ∫ïÊ©üÂà∂ÔºöÂ¢ûÂä†ÊäΩÊï∏
                const currentPity = PITY_SYSTEM.increment(currentKuji.id);
                const ranks = Object.keys(currentKuji.prizes);
                let rank;
                
                if (currentPity >= PITY_SYSTEM.maxDraws) {
                    // Ëß∏Áôº‰øùÂ∫ïÔºöÂº∑Âà∂Áµ¶AË≥û
                    rank = 'A';
                    PITY_SYSTEM.reset(currentKuji.id);
                } else {
                    rank = ranks[Math.floor(Math.random() * ranks.length)];
                    // Â¶ÇÊûúÊäΩÂà∞AË≥ûÔºåÈáçÁΩÆ‰øùÂ∫ïË®àÊï∏
                    if (rank === 'A') {
                        PITY_SYSTEM.reset(currentKuji.id);
                    }
                }
                  const p = currentKuji.prizes[rank];
                drawnPrize = { rank, name: p.name, icon: p.icon };
                
                document.getElementById('selection-overlay').classList.add('hidden');
                openPeelStage();
            }
        }
        
        // ============ Âø´ÈÄüÂãùÂà©ÂåÖÔºöËºîÂä©ÂáΩÊï∏ ============
        
        function toggleFavorite(kujiId) {
            FAVORITE_SYSTEM.toggle(kujiId);
            // ÈáçÊñ∞Ê∏≤ÊüìÁï∂ÂâçÈ†ÅÈù¢
            if (currentKuji && currentKuji.id === kujiId) {
                showView('detail');
            } else {
                showView('list');
            }        }
        
        function closeSelection() {
            document.getElementById('selection-overlay').classList.add('hidden');
            document.body.classList.remove('no-scroll');
        }        function openPeelStage() {
            const overlay = document.getElementById('peel-overlay');
            const cover = document.getElementById('ticket-cover');
            const prizeContent = document.getElementById('prize-content');
            const container = document.getElementById('kuji-ticket-container');
            
            // ÈáçË¶ÅÔºöÈáçÁΩÆÈÅÆÁΩ©Â§ñËßÄËàáÁãÄÊÖã
            document.getElementById('prize-icon').innerText = drawnPrize.icon;
            document.getElementById('prize-rank').innerText = drawnPrize.rank;
            document.getElementById('prize-name').innerText = drawnPrize.name;
            
            // ÈáçÁΩÆÊâÄÊúâÁãÄÊÖãÂíåÊ®£Âºè
            cover.style.clipPath = 'polygon(0% 0%, 100% 0%, 100% 100%, 0% 100%)';
            cover.style.display = ''; // Á¢∫‰øùÈÅÆÁΩ©È°ØÁ§∫
            cover.style.transition = '';
            cover.classList.remove('tearing');
            prizeContent.classList.remove('revealed');
            document.getElementById('peel-hint').classList.remove('hidden');
            
            // Á¢∫‰øùÂÆπÂô®ÈáçÊñ∞Êí≠ÊîæÈÄ≤Â†¥ÂãïÁï´
            container.classList.remove('ticket-enter');
            void container.offsetWidth; // Âº∑Âà∂ÈáçÊéí
            container.classList.add('ticket-enter');
            
            overlay.classList.remove('hidden');
            lucide.createIcons();
            
            // Á®çÂæÆÂª∂ÈÅ≤‰ª•Á¢∫‰øùDOMÊõ¥Êñ∞ÂíåÂãïÁï´ÈñãÂßã
            setTimeout(() => {
                initPeelLogic();
            }, 100);        }function initPeelLogic() {
            const container = document.getElementById('kuji-ticket-container');
            const cover = document.getElementById('ticket-cover');
            const prizeContent = document.getElementById('prize-content');
            let isDragging = false;
            let lastProgress = 0;
            let hasStarted = false;
            let isFinishing = false;
            let startX = 0;
            let startY = 0;
            let totalDistance = 0; // Á¥ØÁ©çÊªëÂãïË∑ùÈõ¢
            
            const handleUpdate = (clientX, clientY) => {
                if (!hasStarted) {
                    hasStarted = true;
                    startX = clientX;
                    startY = clientY;
                    totalDistance = 0;
                }
                if (isFinishing) return;
                
                const rect = container.getBoundingClientRect();
                  // üéØ Êñ∞ÁÆóÊ≥ïÔºöÁ¥ØÁ©çÊªëÂãïË∑ùÈõ¢Ôºà‰ªªÊÑèÊñπÂêëÈÉΩÊúâÊïàÔºâ
                const deltaX = Math.abs(clientX - startX);
                const deltaY = Math.abs(clientY - startY);
                const currentDistance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
                
                // Êõ¥Êñ∞Ëµ∑ÂßãÈªûÁÇ∫Áï∂ÂâçÈªûÔºåËÆìÈÄ£Á∫åÊªëÂãïÁ¥ØÁ©ç
                if (currentDistance > 3) {
                    totalDistance += currentDistance;
                    startX = clientX;
                    startY = clientY;
                }
                
                // Ë®àÁÆóÈÄ≤Â∫¶ÔºöÈôç‰ΩéÈúÄË¶ÅÊªëÂãïÁöÑË∑ùÈõ¢ÔºàÂæû 350px ÈôçÂà∞ 200pxÔºâ
                const maxDistance = 200;
                let progress = Math.min(1, totalDistance / maxDistance);
                progress = Math.pow(progress, 0.6); // Êõ¥Âø´ÁöÑÂä†ÈÄüÔºàÂæû 0.7 ÈôçÂà∞ 0.6Ôºâ
                
                const p = Math.min(100, progress * 100);
                
                // Êõ¥Êñ∞ÈÅÆÁΩ©ÁöÑ clip-path
                cover.style.clipPath = `polygon(${p}% 0%, 100% 0%, 100% 100%, 0% 100%, 0% ${p}%)`;
                
                // Ê∑ªÂä†ÊíïË£ÇÂÖâÊïà
                if (progress > 0.02 && progress < 0.93) {
                    if (progress > lastProgress) {
                        cover.classList.add('tearing');
                    }
                } else {
                    cover.classList.remove('tearing');
                }
                
                // Èö±ËóèÊèêÁ§∫
                if (p > 3) {
                    document.getElementById('peel-hint').classList.add('hidden');
                }
                
                // ÈñãÂßãÈ°ØÁ§∫ÁçéÂìÅ
                if (p > 10 && !prizeContent.classList.contains('revealed')) {
                    prizeContent.classList.add('revealed');
                }
                  // ÂÆåÊàêÊíïÈñãÔºàÈôç‰ΩéÈñæÂÄºÂæû 90% Âà∞ 85%Ôºâ
                if (p > 85 && !isFinishing) {
                    isFinishing = true;
                    finishPeel();
                }
                
                lastProgress = progress;
            };            // Ê°åÈù¢Á´ØÊªëÈº†‰∫ã‰ª∂
            const onMouseDown = (e) => {
                isDragging = true;
                startX = e.clientX;
                startY = e.clientY;
                hasStarted = false;
                handleUpdate(e.clientX, e.clientY);
            };
            
            const onMouseMove = (e) => {
                if (isDragging) {
                    e.preventDefault();
                    handleUpdate(e.clientX, e.clientY);
                }
            };
            
            const onMouseUp = () => {
                isDragging = false;
                cover.classList.remove('tearing');
            };

            // ÁßªÂãïÁ´ØËß∏Êéß‰∫ã‰ª∂
            const onTouchStart = (e) => {
                isDragging = true;
                if (e.cancelable) e.preventDefault();
                const touch = e.touches[0];
                startX = touch.clientX;
                startY = touch.clientY;
                hasStarted = false;
                totalDistance = 0; // ÈáçÁΩÆÁ¥ØÁ©çË∑ùÈõ¢
                handleUpdate(touch.clientX, touch.clientY);
            };
            
            const onTouchMove = (e) => {
                if (isDragging) {
                    if (e.cancelable) e.preventDefault();
                    const touch = e.touches[0];
                    handleUpdate(touch.clientX, touch.clientY);
                }
            };
              const onTouchEnd = () => {
                isDragging = false;
                cover.classList.remove('tearing');
                // ‰∏çÈáçÁΩÆ totalDistanceÔºåËÆìÂ§öÊ¨°ÊªëÂãïÂèØ‰ª•Á¥ØÁ©ç
            };

            // Á∂ÅÂÆö‰∫ã‰ª∂Ôºà‰ΩøÁî® cover ‰ΩúÁÇ∫Ëß∏ÁôºÂÖÉÁ¥†Ôºâ
            cover.addEventListener('mousedown', onMouseDown);
            window.addEventListener('mousemove', onMouseMove);
            window.addEventListener('mouseup', onMouseUp);
            
            cover.addEventListener('touchstart', onTouchStart, { passive: false });
            cover.addEventListener('touchmove', onTouchMove, { passive: false });
            cover.addEventListener('touchend', onTouchEnd);

            // ‰øùÂ≠òÊ∏ÖÁêÜÂáΩÊï∏
            container._cleanup = () => {
                cover.removeEventListener('mousedown', onMouseDown);
                window.removeEventListener('mousemove', onMouseMove);
                window.removeEventListener('mouseup', onMouseUp);
                cover.removeEventListener('touchstart', onTouchStart);
                cover.removeEventListener('touchmove', onTouchMove);
                cover.removeEventListener('touchend', onTouchEnd);
            };
        }        function finishPeel() {
            const cover = document.getElementById('ticket-cover');
            const prizeContent = document.getElementById('prize-content');
            const container = document.getElementById('kuji-ticket-container');
            
            // ÁßªÈô§ÊâÄÊúâ‰∫ã‰ª∂Áõ£ËÅΩ
            if (container._cleanup) {
                container._cleanup();
                container._cleanup = null;
            }
            
            // ÂÅúÊ≠¢ÊâÄÊúâÊïàÊûú
            cover.classList.remove('tearing');
            
            // ÂÆåÂÖ®ÊíïÈñãÂãïÁï´ - ‰øùÊåÅÈÅÆÁΩ©ÂèØË¶ãÁõ¥Âà∞ÂÆåÂÖ®ÁßªÈô§
            cover.style.transition = 'clip-path 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55)';
            cover.style.clipPath = 'polygon(100% 0%, 100% 0%, 100% 100%, 100% 100%, 100% 100%)';
            
            // Á¢∫‰øùÁçéÂìÅÂÆåÂÖ®È°ØÁ§∫
            prizeContent.classList.add('revealed');
            
            // Âª∂ÈÅ≤Ë∑≥ËΩâÂà∞ÁµêÊûúÈ†ÅÈù¢ÔºåÁ≠âÂæÖÊíïÈñãÂãïÁï´ÂÆåÊàê
            setTimeout(() => {
                // ÂÆåÂÖ®ÁßªÈô§ÈÅÆÁΩ©ÁöÑÈ°ØÁ§∫
                cover.style.display = 'none';
                
                setTimeout(() => {
                    document.getElementById('peel-overlay').classList.add('hidden');
                    showResult();
                    // ÈáçÁΩÆÈÅéÊ∏°ÊïàÊûúÂíåÈ°ØÁ§∫
                    cover.style.transition = '';
                    cover.style.display = '';
                }, 200);
            }, 500);
        }        function showResult() {
            const rank = drawnPrize.rank;
            document.getElementById('res-icon').innerText = drawnPrize.icon;
            document.getElementById('res-rank').innerText = rank;
            document.getElementById('res-name').innerText = drawnPrize.name;
            
            const resultCard = document.getElementById('result-card');
            const particlesContainer = document.getElementById('particles-container');
              // Ê∏ÖÈô§‰πãÂâçÁöÑÁâπÊïà
            resultCard.className = 'bg-yellow-400 w-full max-w-sm p-1 border-4 border-black shadow-large animate-scale-in relative mx-auto';
            particlesContainer.innerHTML = '';
            
            // Ê†πÊìöÁ≠âÁ¥öÊ∑ªÂä†‰∏çÂêåÁâπÊïà
            if (rank === 'A') {
                // AË≥ûÔºöÈáëËâ≤Âç°Áâá + Á≤íÂ≠êÁàÜÁÇ∏
                resultCard.classList.add('prize-a-effect');
                resultCard.style.backgroundColor = '#FFD700';
                createGoldParticles();
                
                // ÈúáÂãïÊïàÊûúÔºàÂ¶ÇÊûúÊîØÊåÅÔºâ
                if (navigator.vibrate) {
                    navigator.vibrate([200, 100, 200, 100, 200]);
                }
            } else if (rank === 'B') {
                // BË≥ûÔºöÈäÄËâ≤Âç°Áâá + ÊòüÊòüÈ£ÑËêΩ
                resultCard.classList.add('prize-b-effect');
                resultCard.style.backgroundColor = '#C0C0C0';
                createFallingStars();
            } else if (rank === 'C') {
                // CË≥ûÔºöÂΩ©ËôπÊº∏ËÆäÂç°Áâá
                resultCard.classList.add('prize-c-effect');
                resultCard.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #4facfe 75%, #00f2fe 100%)';
            }
            
            document.getElementById('result-overlay').classList.remove('hidden');
            lucide.createIcons();
        }
        
        // ÂâµÂª∫ÈáëËâ≤Á≤íÂ≠êÁàÜÁÇ∏ÊïàÊûúÔºàAË≥ûÔºâ
        function createGoldParticles() {
            const container = document.getElementById('particles-container');
            const particleCount = 30;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                // Èö®Ê©ü‰ΩçÁΩÆÂú®‰∏≠ÂøÉÈôÑËøë
                const centerX = window.innerWidth / 2;
                const centerY = window.innerHeight / 2;
                particle.style.left = centerX + 'px';
                particle.style.top = centerY + 'px';
                
                // Èö®Ê©üÊñπÂêë
                const angle = (Math.PI * 2 * i) / particleCount;
                const distance = 150 + Math.random() * 100;
                const tx = Math.cos(angle) * distance;
                const ty = Math.sin(angle) * distance;
                
                particle.style.setProperty('--tx', tx + 'px');
                particle.style.setProperty('--ty', ty + 'px');
                
                // ÈáëËâ≤Á≤íÂ≠ê
                particle.style.backgroundColor = '#FFD700';
                particle.style.boxShadow = '0 0 10px #FFD700';
                
                container.appendChild(particle);
                
                // ÂãïÁï´ÁµêÊùüÂæåÁßªÈô§
                setTimeout(() => particle.remove(), 1500);
            }
        }
        
        // ÂâµÂª∫ÈäÄËâ≤ÊòüÊòüÈ£ÑËêΩÊïàÊûúÔºàBË≥ûÔºâ
        function createFallingStars() {
            const container = document.getElementById('particles-container');
            const starCount = 15;
            const stars = ['‚≠ê', '‚ú®', 'üí´', 'üåü'];
            
            for (let i = 0; i < starCount; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.textContent = stars[Math.floor(Math.random() * stars.length)];
                
                // Èö®Ê©üÊ∞¥Âπ≥‰ΩçÁΩÆ
                star.style.left = Math.random() * 100 + '%';
                star.style.top = '-50px';
                
                // Èö®Ê©üÂª∂ÈÅ≤
                star.style.animationDelay = (Math.random() * 0.5) + 's';
                
                container.appendChild(star);
                
                // ÂãïÁï´ÁµêÊùüÂæåÁßªÈô§
                setTimeout(() => star.remove(), 2500);
            }
        }        function show10DrawResults(results) {
            const overlay = document.getElementById('draw10-overlay');
            const resultsContainer = document.getElementById('draw10-results');
            const statsContainer = document.getElementById('draw10-stats');
            
            // Áµ±Ë®àÂêÑÁ≠âÁ¥öÊï∏Èáè
            const rankCount = {};
            results.forEach(r => {
                rankCount[r.rank] = (rankCount[r.rank] || 0) + 1;
            });
            
            // ÊâæÂá∫ÊúÄÈ´òÁ≠âÁ¥ö
            const hasA = rankCount['A'] > 0;
            const hasB = rankCount['B'] > 0;
              // üéä ÂÑ™ÂåñÈ°ØÁ§∫ÔºöÂ§ßÁçéÈ°ØÁ§∫Âú®‰∏äÊñπÔºåÂÖ∂‰ªñÁçéÂìÅÊ©´ÂêëÊªëÂãï
            let highlightHTML = '';
            let normalCards = [];
            
            results.forEach((prize, index) => {
                const isHighlight = prize.rank === 'A' || prize.rank === 'B';
                
                if (isHighlight) {
                    // A/BË≥ûÔºöÂ§ßÂç°Áâá
                    highlightHTML += `
                        <div class="relative bg-white border-4 shadow-[4px_4px_0px_rgba(0,0,0,1)] md:shadow-[6px_6px_0px_rgba(0,0,0,1)] border-black p-3 md:p-4 text-center col-span-1 md:col-span-2">
                            <div class="absolute -top-1 -right-1 md:-top-2 md:-right-2 bg-yellow-400 text-black font-black text-[10px] md:text-xs px-1.5 py-0.5 md:px-2 md:py-1 border border-black md:border-2 rotate-12 animate-pulse">HIT!</div>
                            <div class="text-[10px] md:text-xs font-bold text-purple-600 mb-1">#${index + 1}</div>
                            <div class="text-5xl md:text-7xl mb-2 md:mb-3 animate-bounce">${prize.icon}</div>
                            <div class="text-3xl md:text-5xl font-black italic font-bebas ${prize.rank === 'A' ? 'text-yellow-600' : 'text-gray-600'}">${prize.rank}</div>
                            <div class="text-xs md:text-sm font-bold text-gray-600 mt-1 md:mt-2 line-clamp-2">${prize.name}</div>
                        </div>
                    `;
                } else {
                    // ÊôÆÈÄöÁçéÂìÅÔºöÂ∞èÂç°ÁâáÔºàÊ©´ÂêëÊªëÂãïÔºâ
                    normalCards.push(`
                        <div class="flex-shrink-0 w-28 md:w-32 bg-white border-2 border-black shadow-[2px_2px_0px_rgba(0,0,0,1)] p-2 md:p-3 text-center">
                            <div class="text-[9px] md:text-[10px] font-bold text-gray-500 mb-1">#${index + 1}</div>
                            <div class="text-3xl md:text-4xl mb-1">${prize.icon}</div>
                            <div class="text-xl md:text-2xl font-black italic font-bebas text-black">${prize.rank}</div>
                            <div class="text-[10px] md:text-xs font-bold text-gray-600 mt-1 truncate">${prize.name}</div>
                        </div>
                    `);
                }
            });
            
            // ÁµÑÂêàHTMLÔºöÂ§ßÁçéÂú®‰∏äÊñπÁ∂≤Ê†ºÔºåÊôÆÈÄöÁçéÂìÅÊ©´ÂêëÊªëÂãï
            let finalHTML = '';
            
            // ÊÅ≠Âñú‰∏≠ÁçéÊ©´ÂπÖ
            if (highlightHTML) {
                finalHTML += '<div class="col-span-full text-center mb-2 md:mb-3"><div class="inline-block bg-gradient-to-r from-yellow-400 to-orange-400 text-black font-black px-4 py-1.5 md:px-6 md:py-2 text-sm md:text-lg border-2 border-black uppercase">üéâ ÊÅ≠Âñú‰∏≠ÁçéÔºÅ</div></div>';
            }
            
            // A/BË≥ûÂ§ßÁçé
            finalHTML += highlightHTML;
            
            // ÂàÜÈöîÁ∑ö
            if (highlightHTML && normalCards.length > 0) {
                finalHTML += '<div class="col-span-full border-t border-dashed md:border-t-2 border-gray-300 my-2 md:my-3"></div>';
            }
            
            // ÊôÆÈÄöÁçéÂìÅÊ©´ÂêëÊªëÂãïÂçÄÂüü
            if (normalCards.length > 0) {
                finalHTML += `
                    <div class="col-span-full">
                        <div class="flex items-center gap-2 mb-2">
                            <div class="text-xs md:text-sm font-bold text-gray-500 uppercase">ÂÖ∂‰ªñÁçéÂìÅ</div>
                            <div class="text-[10px] md:text-xs text-gray-400">‚Üê ÊªëÂãïÊü•ÁúãÊõ¥Â§ö</div>
                        </div>
                        <div class="flex gap-2 md:gap-3 overflow-x-auto scrollbar-hide pb-2">
                            ${normalCards.join('')}
                        </div>
                    </div>
                `;
            }
            
            resultsContainer.innerHTML = finalHTML;
              // üìä ÂÑ™ÂåñÁµ±Ë®àÔºö‰ΩøÁî®Êõ¥Áõ¥ËßÄÁöÑÂúñË°®ÂºèÈ°ØÁ§∫
            const sortedRanks = Object.entries(rankCount).sort((a, b) => a[0].localeCompare(b[0]));
            statsContainer.innerHTML = sortedRanks.map(([rank, count]) => {
                const percentage = (count / 10 * 100).toFixed(0);
                const isHighRank = rank === 'A' || rank === 'B';
                return `
                    <div class="bg-white border-2 border-black p-2 md:p-4 ${isHighRank ? 'col-span-1' : ''}">
                        <div class="flex items-center justify-between mb-1 md:mb-2">
                            <div class="font-black text-lg md:text-2xl ${rank === 'A' ? 'text-yellow-600' : rank === 'B' ? 'text-gray-600' : 'text-black'}">${rank}Ë≥û</div>
                            <div class="text-2xl md:text-3xl font-bebas ${rank === 'A' ? 'text-yellow-600' : 'text-purple-600'}">√ó${count}</div>
                        </div>
                        <div class="w-full bg-gray-200 h-2 md:h-3 border border-black overflow-hidden">
                            <div class="h-full ${rank === 'A' ? 'bg-yellow-500' : rank === 'B' ? 'bg-gray-500' : 'bg-purple-500'} transition-all duration-500" style="width: ${percentage}%"></div>
                        </div>
                        <div class="text-[10px] md:text-xs text-gray-500 mt-1 text-right font-bold">${percentage}%</div>
                    </div>
                `;
            }).join('');
            
            overlay.classList.remove('hidden');
            lucide.createIcons();
        }

        showView('list');
    </script>
</body>
</html>